# 权限
权限模块在大多数软件系统中是不可缺少的一部分，因为它限制了软件系统中不同需求用户所能操作和查看的资源，保证了系统的安全性。但权限模块也是系统中比较复杂的一部分，因为需要根据不同的用户架构来实现具体细节。仔细划分下，可以将【权限】划分为**功能权限**和**数据权限**。

> **功能权限：**指用户登录系统后看到什么模块，能看到哪些页面。**数据权限：**指用户在某个模块中能看到什么数据。

在权限系统中，我们需要考虑如何为不同用户快速配置权限？功能权限中用户所能操作资源的粒度是模块级的、页面级还是更细的粒度？在不同的模块中数据权限如何设计等问题。当然这些问题都要在具体情况下去讨论。在目前的软件架构中，软件模块最常见的是依照[-[RBAC]-](基于角色的控制模型)这一权限模型去设计。

## 权限设计
### 功能权限
功能权限的粒度从粗到细一般分为：模块级->页面级->接口级。一般粒度越粗，用户操作越简单，灵活度就越低，并且功能权限在设计时还要注意一点：**如果权限必须细化到页面甚至时接口级别时，在分配低优先级的功能必须分配高优先级的功能，否则会出现可以进行删除操作，但是无法查询相关数据的窘况**。

### 数据权限
数据权限与组织架构相关，并且组织架构可以分为**树状**和**扁平状**。
![数据权限](/img/data_authority.png)

接下来，我们着重来探讨树状结构，并且可以把扁平状看作是一种特殊的树型结构。
* **结点之间数据共享**
![数据共享](/img/data_share.png)

数据共享表示如下几种情况：
1. 父部门可以管理所有的子部门的数据：G可以查看A、B的所有用户和资产
2. 子节点可以管理父节点的数据：A1可以管理G的所有用户和所有资产
3. 兄弟结点之间可以相互管理：用户A1可以管理部门B的所有用户和所有资产
4. 结点只能管理自己所在结点的数据：用户A1只能管理部门A的所有用户
5. 结点里的用户只能看到自己的数据

* **部门用户存在上下级关系**
![上下级关系](/img/data_hira.png)

用户A1是用户A2的上级，并要求用户A1能看到用户A2的数据，而用户A2不能看到用户A1的数据。

## [-[RBAC]-]模型
[-[RBAC]-]模型（基于角色的控制模型）是一种分析模型，[-[RBAC]-]认为权限的过程可以抽象概括为：判断`Who是否可以对What进行How的访问操作（Operator）`这个逻辑表达式是否为[-[True]-]的求解过程。

[-[RBAC]-]支持公认的安全原则：最小权限原则、责任分离原则和数据抽象原则，但并不要求设计者一定要遵守这些原则。
* 最小权限原则：分配给某用户对应的角色的权限不应该超过该用户完成其任务的需要就好了。
* 责任分离原则：在[-[RBAC]-]中，对于完成敏感任务过程时，可以创建两个责任上相互约束的角色来实现。比如设置财务管理员和会计两个角色。
* 数据抽象原则：对于某些敏感任务，比如账目管理活动，可以使用信用、借方等抽象许可权，而不是使用操作系统提供的读、写、执行等具体的许可权。

[-[RBAC]-]是个模型族其中包括了：基本模型（[-[RBAC0]-]）、角色分成模型（[-[RBAC1]-]）、角色限制模型（[-[RBAC2]-]）和统一模型（[-[RBAC3]-]）。

### [-[RBAC0]-]
![RBAC0](/img/RBAC0.png)

[-[RBAC0]-]定义了一个构成[-[RBAC]-]控制系统的最小元素集合，其中包含了用户（user）、角色（Role）、许可（相应资源和操作-Permission）以及会话（Session）。将许可与角色相关联而不是直接与用户相关联的好处在于**降低了功能权限分配和之后修改的复杂度**。

在该模型中，用户与角色是多对多的关系、角色与许可之间是多对多的关系。这表示一个用户可以创建会话并激活多个用户角色，从而获取相应的访问权限，用户可以在访问中更改激活角色，并且用户可以主动结束这一会话。

### [-[RBAC1]-]
![RBAC1](/img/RBAC1.png)

[-[RBAC1]-]建立在[-[RBAC0]-]基础上，在角色中引入继承的概念，有了继承那么角色就有了上下级或等级关系，角色间的继承一般可以分为继承关系和受限继承关系。一般继承关系仅要求角色继承关系是一个偏序关系，允许角色之间的多继承，而受限继承关系则进一步要求角色继承关系是一个树结构，实现角色间的单继承。

### [-[RBAC2]-]
![RBAC2](/img/RBAC2.png)

[-[RBAC1]-]建立在[-[RBAC0]-]基础上，在角色和用户之间假设了约束的概念，主要引入了静态职责分离[-[SSD]-]和动态职责分离[-[DSD]-]。

[-[SSD]-]主要对用户和角色有如下约束：
* 互斥角色：同一用户在两个互斥角色中只能选择一个
* 基数约束：一个用户拥有的角色是有限的，一个角色拥有的许可也是有限的
* 先决条件约束：用户想要获得高级角色，首先必须拥有低级角色

[-[DSD]-]是会话和角色间的约束，可以动态的约束用户拥有的角色，如果一个用户可以拥有两个角色，但是运行时只能激活一个角色。

### [-[RBAC3]-]
![RBAC3](/img/RBAC3.png)

[-[RBAC3]-]建立在[-[RBAC0]-]基础上，并且对[-[RBAC1]-]和[-[RBAC2]-]进行了整合。

## 参考资料

* [权限系统与RBAC模型概述](https://www.debugger.wiki/article/html/156346561090464)

## 具体应用

* [Ruoyi-权限部分解析](/function/authority/index)